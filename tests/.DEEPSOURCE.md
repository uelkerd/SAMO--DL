Using variable 'MAX_AUDIO_FILE_SIZE_MB' before assignment
deployment/cloud-run/secure_api_server.py

Ignore
logger = logging.getLogger(__name__)

app = Flask(__name__)
app.config['MAX_CONTENT_LENGTH'] = MAX_AUDIO_FILE_SIZE_MB * 1024 * 1024

# Add security headers
add_security_headers(app)

Variable used before assignment PYL-E0601
Category
Bug risk
Severity
Critical
Occurrences
1
Description
This local variable name is being used before it is defined. This will throw an UnboundLocalError. It is recommended to refactor this code.

Bad practice
def used_before_assignment(a):
    if x == a:  # x is defined in the next line
        for x in [1, 2]:
            pass
Recommended
def correct_usage(a):
    for x in [1, 2]:
        if x == a:
            pass

--

Undefined name detected PYL-E0602
Category
Bug risk
Severity
Critical
Occurrences
8
Description
The variable name is not defined where it is used. This will lead to an error during the runtime. Make sure there is no typo. If the name was supposed to be imported, verify that you've actually imported the name.

Bad practice
import os.path

if os.path.exits('setup.cfg'):  # misspelled `exists`
    print('Found config file')
Preferred:
import os.path

if os.path.exists('setup.cfg'):
    print('Found config file')

Undefined variable 'sys'
scripts/pre-download-models.py

Ignore
    else:
        print(f"‚ö†Ô∏è  {success_count}/{len(models)} models downloaded successfully")
        print("‚ùå Partial failure - exiting with error code")
        sys.exit(1)

    print(f"‚è±Ô∏è  Total download time: {total_duration:.1f}s")
    # Show cache size
Undefined variable 'sys'
scripts/pre-download-models.py

Ignore
        print("‚úÖ All models downloaded successfully!")
        print("üí° You can now copy models_cache to your Docker build context")
        print("   or mount it as a volume during build")
        sys.exit(0)
    else:
        print(f"‚ö†Ô∏è  {success_count}/{len(models)} models downloaded successfully")
        print("‚ùå Partial failure - exiting with error code")
Undefined variable 'sys'
scripts/pre-download-models.py

Ignore
    min_free_gb = 1.5
    if free_gb < min_free_gb:
        print(f"‚ùå Insufficient disk space: {free_gb:.2f}GB available, {min_free_gb}GB required")
        sys.exit(1)
    print(f"Available disk space: {free_gb:.2f} GB (sufficient)")
    print()
Undefined variable 'HfHubHTTPError'
scripts/pre-download-models.py

Ignore
        whisper.load_model(model_size, download_root=cache_dir)
        duration = time.time() - start_time
        print(f"‚úÖ Downloaded Whisper model in {duration:.1f}s")
    except (OSError, RuntimeError, ValueError, HfHubHTTPError) as e:
        print(f"‚ùå Failed to download Whisper model: {e}")
        return False
    return True
Undefined variable 'HfHubHTTPError'
scripts/pre-download-models.py

Ignore

        duration = time.time() - start_time
        print(f"‚úÖ Downloaded T5 model in {duration:.1f}s")
    except (OSError, RuntimeError, ValueError, HfHubHTTPError) as e:
        print(f"‚ùå Failed to download T5 model: {e}")
        return False
    return True
Undefined variable 'HfHubHTTPError'
scripts/pre-download-models.py

Ignore

        duration = time.time() - start_time
        print(f"‚úÖ Downloaded emotion model in {duration:.1f}s")
    except (OSError, RuntimeError, ValueError, HfHubHTTPError) as e:
        print(f"‚ùå Failed to download emotion model: {e}")
        return False
    return True
Undefined variable 'train_data'
scripts/legacy/retrain_with_expanded_dataset.py

Ignore
        'num_labels': len(label_encoder.classes_),
        'all_emotions': list(label_encoder.classes_),
        'training_history': training_history,
        'expanded_samples': len(X_test) + len(list(train_data[0])) + len(list(val_data[0])),
        'test_samples': len(X_test)
    }
    
Undefined variable 'val_data'
scripts/legacy/retrain_with_expanded_dataset.py

Ignore
        'num_labels': len(label_encoder.classes_),
        'all_emotions': list(label_encoder.classes_),
        'training_history': training_history,
        'expanded_samples': len(X_test) + len(list(train_data[0])) + len(list(val_data[0])),
        'test_samples': len(X_test)
    }
    

---

Unused variable found PYL-W0612
Category
Anti-pattern
Severity
Major
Occurrences
4
Description
An unused variable takes up space in the code, and can lead to confusion, and it should be removed. If this variable is necessary, name the variable _ to indicate that it will be unused, or start the name with unused or _unused.

Bad practice
def update():
    for i in range(10): # Usused variable `i`
        time.sleep(0.01)
        display_result()
Preferred:
def update():
    for _ in range(10):
        time.sleep(0.01)
        display_result()

Unused variable 'end_time'
deployment/local/test_api.py

Ignore
Unused variable 'start_time'
deployment/local/test_api.py

Ignore
def test_batch_predictions() -> Optional[bool]:
    """Test batch predictions."""
    try:
        start_time = time.time()
        response = requests.post(
            f"{BASE_URL}/predict_batch",
            json={"texts": TEST_TEXTS[:5]},
Unused variable 'invalid_type_data'
deployment/cloud-run/test_complete_api.py

Ignore
    results['emotion_missing_input'] = invalid_success

    # Test 2c: Emotion Detection - Invalid Data Type
    invalid_type_success, invalid_type_data = test_endpoint(
        "Emotion Detection (Invalid Data Type)",
        "POST",
        f"{API_BASE_URL}/api/predict",
Unused variable 'invalid_data'
deployment/cloud-run/test_complete_api.py

Ignore
        data.get('confidence', 0.0)

    # Test 2b: Emotion Detection - Missing Input
    invalid_success, invalid_data = test_endpoint(
        "Emotion Detection (Missing Input)",
        "POST",
        f"{API_BASE_URL}/api/predict",

---

Expression not assigned PYL-W0106
Category
Performance
Severity
Major
Occurrences
7
Description
An expression that is not a function call is assigned to nothing. Probably something else was intended here. We recommend to review this.


Search for issue title, file or issue code
Expression "pred['text'][:30] + '...' if len(pred['text']) > 30 else pred['text']" is assigned to nothing
deployment/local/test_api.py

Ignore
            
            
            for _i, pred in enumerate(predictions, 1):
                pred['text'][:30] + "..." if len(pred['text']) > 30 else pred['text']
            
            return True
        else:
Expression "sum((r['prediction_time_ms'] for r in results)) / len(results)" is assigned to nothing
deployment/local/test_api.py

Ignore
    
    # Calculate average performance
    sum(r['confidence'] for r in results) / len(results)
    sum(r['prediction_time_ms'] for r in results) / len(results)
    
    return True
Expression "sum((r['confidence'] for r in results)) / len(results)" is assigned to nothing
deployment/local/test_api.py

Ignore
            return False
    
    # Calculate average performance
    sum(r['confidence'] for r in results) / len(results)
    sum(r['prediction_time_ms'] for r in results) / len(results)
    
    return True
Expression "data['summary'].get('summary', '')[:50]" is assigned to nothing
deployment/cloud-run/test_complete_api.py

Ignore
                    data['emotion_analysis'].get('primary_emotion', 'unknown')

                if data.get('summary'):
                    data['summary'].get('summary', '')[:50]
    else:
        results['complete_analysis_audio'] = None
Expression "data['transcription'].get('text', '')[:100]" is assigned to nothing
deployment/cloud-run/test_complete_api.py

Ignore
                data.get('pipeline_status', {})

                if data.get('transcription'):
                    data['transcription'].get('text', '')[:100]

                if data.get('emotion_analysis'):
                    data['emotion_analysis'].get('primary_emotion', 'unknown')
Expression "data['summary'].get('summary', '')[:50]" is assigned to nothing
deployment/cloud-run/test_complete_api.py

Ignore
            data['emotion_analysis'].get('primary_emotion', 'unknown')

        if data.get('summary'):
            data['summary'].get('summary', '')[:50]

    # Test 4b: Complete Analysis Pipeline - Audio Input (if available)
    test_audio_path = "test_audio.wav"
Expression "time.time() - start_time" is assigned to nothing
deployment/cloud-run/test_complete_api.py

Ignore
            return True, response.text

    except requests.exceptions.RequestException as e:
        time.time() - start_time
        return False, str(e)

def main() -> bool:


--


Unnecessary else / elif used after return PYL-R1705
Category
Style
Severity
Major
Occurrences
1
Description
The use of else or elif becomes redundant and can be dropped if the last statement under the leading if / elif block is a return statement. In the case of an elif after return, it can be written as a separate if block. For else blocks after return, the statements can be shifted out of else. Please refer to the examples below for reference.

Refactoring the code this way can improve code-readability and make it easier to maintain.

Bad practice
def classify_number(x):
    if x % 2 == 0:
        return 'Even'
    else:
        return 'Odd'


def what_is_this_number(x):
    if x % 2 == 0 and x >= 0:
        return 'Even'
    elif x % 2 == 0 and x < 0:
        return 'Even and Negative'
    elif x % 2 != 0 and x < 0:
        return 'Odd and Negative.'
    else:
        return 'Odd'
Preferred:
def classify_number(x):
    if x % 2 == 0:
        return 'Even'

    return 'Odd'


def what_is_this_number(x):
    if x % 2 == 0 and x >= 0:
        return 'Even'

    if x % 2 == 0 and x < 0:
        return 'Even and Negative'

    if x % 2 != 0 and x < 0:
        return 'Odd and Negative'

    return 'Odd'

Unnecessary "else" after "return", remove the "else" and de-indent the code inside it
deployment/local/test_api.py

Ignore
    
    successful = [r for r in results if r['status_code'] == 200]
    
    if successful:
        avg_response_time = sum(r['response_time'] for r in successful) / len(successful)
        min(r['response_time'] for r in successful)
        max(r['response_time'] for r in successful)

---

Re-defined variable from outer scope PYL-W0621
Category
Anti-pattern
Severity
Major
Occurrences
2
Description
The local variable name hides the variable defined in the outer scope, making it inaccessible and might confuse.

Bad practice
filename = 'myfile.txt'

def read_file(filename):  # This shadows the global `filename`
    with open(filename) as file:
        return file.readlines()
Preferred:
FILENAME = 'myfile.txt'  # renamed global to UPPER_CASE as convention

def read_file(filename):
    with open(filename) as file:
        return file.readlines()
Bad practice
Another usual suspect of this is when you use the same parameter name inside a function as the global variable you are using. For example:

def run_app(app):
    # This `app` shadows the global app...
    app.run()

if __name__ == '__main__':
    app = MyApp()  # This is a global variable!
    run_app(app)
Preferred:
To avoid this re-defining of a global, consider not defining app as a global, but inside a main() function instead:

def run_app(app):
    # There is no longer a global `app` variable.
    app.run()

def main():
    app = MyApp()
    run_app(app)

if __name__ == '__main__':
    main()

Redefining name 'app' from outer scope (line 24)
deployment/cloud-run/robust_predict.py

Ignore
    import gunicorn.app.base
    
    class StandaloneApplication(gunicorn.app.base.BaseApplication):
        def __init__(self, app, options=None) -> None:
            self.options = options or {}
            self.application = app
            super().__init__()
Redefining name 'options' from outer scope (line 290)
deployment/cloud-run/robust_predict.py

Ignore
    import gunicorn.app.base
    
    class StandaloneApplication(gunicorn.app.base.BaseApplication):
        def __init__(self, app, options=None) -> None:
            self.options = options or {}
            self.application = app
            super().__init__()

---

Function or method is being redefined PYL-E0102
Category
Bug risk
Severity
Major
Occurrences
2
Description
A function, method or class is being redefined in the same scope. This would override the original definition, and doing this is strongly discouraged. Please verify that this is something that you intended to do. Redefining anything can lead to confusion, decreases code readability and may cause bugs that are difficult to diagnose. It is recommended either to refactor the function/method/class, or choose different names.

Bad practice
def calc(x, y):
    return x + y


def calc(x, y):
    return x * y
Recommended
def calc_sum(x, y):
    return x + y


def calc_product(x, y):
    return x * y

function already defined line 27
deployment/cloud-run/test_direct_errorhandler.py

Ignore
        return {"error": "Rate limit exceeded"}, 429
    
    @api.errorhandler(500)
    def internal_error_handler(error):
        return {"error": "Internal server error"}, 500
    
    
function already defined line 24
deployment/cloud-run/test_direct_errorhandler.py

Ignore
    
    # Try to register directly
    @api.errorhandler(429)
    def rate_limit_handler(error):
        return {"error": "Rate limit exceeded"}, 429
    
    @api.errorhandler(500)

---

Empty block of code found PTC-W0047
Category
Anti-pattern
Severity
Major
Occurrences
1
Description
In most cases, an empty body of for, while or if implies some piece of code is missing. Such empty block must be either filled or removed.

Bad practice
for i in range(10):
    pass
Preferred:
for i in range(10):
    print(i)

Body doesn't contain any code
deployment/cloud-run/test_routing_debug.py

Ignore
        endpoints[rule.endpoint] = rule.rule

# Check what Flask-RESTX created for the root route
for rule in app.url_map.iter_rules():
    pass

----

Branches of the if statement have similar implementation PTC-W0051
Category
Anti-pattern
Severity
Major
Occurrences
3
Description
For the highlighted if statements, all the elif / else branches have the same body as if. It is recommended to refactor this snippet.

If the if-chain is performing the same action in every case, it shouldn't be used there at all.

Not preferred:
if b == 0:
    do_something()
elif b == 1:
    do_something()
else:
    do_something()

b = 4 if a > 12 else 4
Preferred:
# If this is was a copy-paste error, review and update the snippet
if b == 0:
    do_something()
elif b == 1:
    do_something_else()
else:
    do_other_thing()

b = -4 if a > 12 else 4

# OR
# Refactor the code to not use the if-chain at all.
do_something()

b = 4

All branches in the conditional structure have same implementation
deployment/cloud-run/test_routing_fixed.py

Ignore
    
    # Check if docs endpoint exists
    docs_routes = [rule for rule in app.url_map.iter_rules() if rule.rule == '/docs']
    if docs_routes:
        pass
    else:
        pass
All branches in the conditional structure have same implementation
deployment/cloud-run/test_routing_fixed.py

Ignore
    
    # Check if health endpoint exists
    health_routes = [rule for rule in app.url_map.iter_rules() if '/health' in rule.rule]
    if health_routes:
        pass
    else:
        pass
All branches in the conditional structure have same implementation
deployment/cloud-run/test_routing_fixed.py

Ignore
    
    # Check if root endpoint exists
    root_routes = [rule for rule in app.url_map.iter_rules() if rule.rule == '/']
    if root_routes:
        pass
    else:
        pass

        